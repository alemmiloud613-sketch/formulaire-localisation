<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulaire Client</title>
    <style>
        body { font-family: Arial; margin: 20px; background: #f5f5f5; }
        .card { background: white; padding: 20px; border-radius: 10px; margin: 10px 0; }
        button { background: #4285f4; color: white; border: none; padding: 15px; width: 100%; border-radius: 5px; margin: 10px 0; }
        .success { background: #e6f4ea; padding: 15px; border-radius: 5px; }
        .error { background: #fce8e6; padding: 15px; border-radius: 5px; }
    </style>
</head>
<body>
    <div class="card">
        <h2>üìç Localisation Requise</h2>
        
        <div id="status">
            <p>Cliquez pour d√©tecter votre position :</p>
        </div>

        <button onclick="detectLocation()">D√âTECTER MA POSITION</button>

        <div id="manualSection" style="display: none;">
            <input type="text" id="cityInput" placeholder="Entrez votre ville" style="width: 100%; padding: 10px; margin: 10px 0;">
            <button onclick="useManualLocation()">VALIDER LA VILLE</button>
        </div>

        <div id="successSection" style="display: none;" class="success">
            <p>‚úÖ Position enregistr√©e !</p>
            <p id="locationText"></p>
            <button onclick="redirectToForm()">ACC√âDER AU FORMULAIRE</button>
        </div>
    </div>

    <script>
        function detectLocation() {
            document.getElementById('status').innerHTML = '<p>üîÑ D√©tection en cours...</p>';
            
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        const lat = position.coords.latitude;
                        const lng = position.coords.longitude;
                        
                        // Utiliser un service simple pour l'adresse
                        fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}`)
                            .then(r => r.json())
                            .then(data => {
                                const address = data.display_name || `Position: ${lat.toFixed(4)}, ${lng.toFixed(4)}`;
                                showSuccess(address);
                            })
                            .catch(() => {
                                showSuccess(`Position: ${lat.toFixed(4)}, ${lng.toFixed(4)}`);
                            });
                    },
                    function(error) {
                        document.getElementById('status').innerHTML = '<p class="error">‚ùå D√©tection automatique √©chou√©e</p>';
                        document.getElementById('manualSection').style.display = 'block';
                    }
                );
            } else {
                document.getElementById('manualSection').style.display = 'block';
            }
        }

        function showSuccess(address) {
            document.getElementById('locationText').textContent = address;
            document.getElementById('successSection').style.display = 'block';
            document.getElementById('manualSection').style.display = 'none';
        }

        function useManualLocation() {
            const city = document.getElementById('cityInput').value;
            if (city) {
                showSuccess(city);
            } else {
                alert('Veuillez entrer votre ville');
            }
        }

        function redirectToForm() {
            window.location.href = 'https://docs.google.com/forms/d/e/1FAIpQLSdXfa6fpkstuILCClpU7ZpNpP70KAI1GFlV2EkdN_VIXAFXDQ/viewform';
        }

        // D√©marrer automatiquement
        setTimeout(detectLocation, 1000);
    </script>
</body>
</html>
